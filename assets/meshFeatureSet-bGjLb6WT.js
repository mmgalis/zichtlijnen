import{aS as h,aT as S,g as d,aU as y,aV as m,aW as N,aX as D,aY as M,aZ as g,a_ as w,a$ as T,a7 as F}from"./index-2x4JY06U.js";const I=()=>F.getLogger("esri.rest.support.meshFeatureSet");function G(t,e,s){const n=s.features;s.features=[],delete s.geometryType;const r=h.fromJSON(s);if(r.geometryType="mesh",!s.assetMaps)return r;const a=A(e,s.assetMaps),i=t.sourceSpatialReference??S.WGS84,l=s.globalIdFieldName,{outFields:o}=t,f=o!=null&&o.length>0?$(o.includes("*")?null:new Set(o)):()=>({});for(const u of n){const c=L(u,l,i,e,a);r.features.push(new d({geometry:c,attributes:f(u)}))}return r}function $(t){return({attributes:e})=>{if(!e)return{};if(!t)return e;for(const s in e)t.has(s)||delete e[s];return e}}function L(t,e,s,n,r){const a=t.attributes[e],i=r.get(a);if(i==null||!t.geometry)return null;const l=O(t,s,n),o=y.fromJSON(t.geometry);o.spatialReference=s;const f=x(t.attributes,n),u=s.isGeographic?"local":"georeferenced",c=P(i);return c?m.createWithExternalSource(l,c,{extent:o,transform:f,vertexSpace:u}):m.createIncomplete(l,{extent:o,transform:f,vertexSpace:u})}function O({attributes:t},e,{transformFieldRoles:s}){const n=t[s.originX],r=t[s.originY],a=t[s.originZ];return new N({x:n,y:r,z:a,spatialReference:e})}function x(t,{transformFieldRoles:e}){return new D({translation:[t[e.translationX],-t[e.translationZ],t[e.translationY]],rotationAxis:[t[e.rotationX],-t[e.rotationZ],t[e.rotationY]],rotationAngle:t[e.rotationDeg],scale:[t[e.scaleX],t[e.scaleZ],t[e.scaleY]]})}var p;function A(t,e){const s=new Map;for(const n of e){const r=n.parentGlobalId;if(r==null)continue;const a=n.assetName,i=n.assetType,l=n.assetHash,o=n.assetURL,f=n.conversionStatus,u=n.seqNo,c=M(i,t.supportedFormats);if(!c){I().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${i}, but it does not list it as a supported type`);continue}const E=g(s,r,()=>({files:new Map}));g(E.files,a,()=>({name:a,type:i,mimeType:c,status:b(f),parts:[]})).parts[u]={hash:l,url:o}}return s}function P(t){const e=Array.from(t.files.values()),s=new Array;for(const n of e){if(n.status!==p.COMPLETED)return null;const r=new Array;for(const a of n.parts){if(!a)return null;r.push(new w(a.url,a.hash))}s.push(new T(n.name,n.mimeType,r))}return s}function b(t){switch(t){case"COMPLETED":case"SUBMITTED":return p.COMPLETED;case"INPROGRESS":return p.PENDING;default:return p.FAILED}}(function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"})(p||(p={}));export{A as assetMapFromAssetMapsJSON,L as extractMesh,G as meshFeatureSetFromJSON};
